"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[6375],{3905:function(e,a,o){o.d(a,{Zo:function(){return m},kt:function(){return f}});var r=o(7294);function s(e,a,o){return a in e?Object.defineProperty(e,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[a]=o,e}function n(e,a){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),o.push.apply(o,r)}return o}function t(e){for(var a=1;a<arguments.length;a++){var o=null!=arguments[a]?arguments[a]:{};a%2?n(Object(o),!0).forEach((function(a){s(e,a,o[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))}))}return e}function i(e,a){if(null==e)return{};var o,r,s=function(e,a){if(null==e)return{};var o,r,s={},n=Object.keys(e);for(r=0;r<n.length;r++)o=n[r],a.indexOf(o)>=0||(s[o]=e[o]);return s}(e,a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)o=n[r],a.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(s[o]=e[o])}return s}var p=r.createContext({}),u=function(e){var a=r.useContext(p),o=a;return e&&(o="function"==typeof e?e(a):t(t({},a),e)),o},m=function(e){var a=u(e.components);return r.createElement(p.Provider,{value:a},e.children)},d="mdxType",l={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},c=r.forwardRef((function(e,a){var o=e.components,s=e.mdxType,n=e.originalType,p=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),d=u(o),c=s,f=d["".concat(p,".").concat(c)]||d[c]||l[c]||n;return o?r.createElement(f,t(t({ref:a},m),{},{components:o})):r.createElement(f,t({ref:a},m))}));function f(e,a){var o=arguments,s=a&&a.mdxType;if("string"==typeof e||s){var n=o.length,t=new Array(n);t[0]=c;var i={};for(var p in a)hasOwnProperty.call(a,p)&&(i[p]=a[p]);i.originalType=e,i[d]="string"==typeof e?e:s,t[1]=i;for(var u=2;u<n;u++)t[u]=o[u];return r.createElement.apply(null,t)}return r.createElement.apply(null,o)}c.displayName="MDXCreateElement"},1991:function(e,a,o){o.r(a),o.d(a,{contentTitle:function(){return p},default:function(){return c},frontMatter:function(){return i},metadata:function(){return u},toc:function(){return m}});var r=o(7462),s=o(3366),n=(o(7294),o(3905)),t=["components"],i={},p="Transfer\xeancia de Arquivos",u={unversionedId:"old/Hardware/4G/TransArqv",id:"old/Hardware/4G/TransArqv",isDocsHomePage:!1,title:"Transfer\xeancia de Arquivos",description:"---",source:"@site/../docs/old/Hardware/4G/TransArqv.md",sourceDirName:"old/Hardware/4G",slug:"/old/Hardware/4G/TransArqv",permalink:"/knowledge_base/docs/old/Hardware/4G/TransArqv",editUrl:"https://github.com/SkyRats/knowledge_base/tree/main/docs/../docs/old/Hardware/4G/TransArqv.md",tags:[],version:"current",frontMatter:{},sidebar:"docssidebar",previous:{title:"Introdu\xe7\xe3o ao Hardware",permalink:"/knowledge_base/docs/old/Hardware/introHW"},next:{title:"Como escolher um ESC?",permalink:"/knowledge_base/docs/old/Hardware/Componentes/ESCs"}},m=[{value:"1. Introdu\xe7\xe3o",id:"1-introdu\xe7\xe3o",children:[],level:2},{value:"2. Como foi feito?",id:"2-como-foi-feito",children:[],level:2},{value:"3. C\xf3digo completo",id:"3-c\xf3digo-completo",children:[],level:2}],d={toc:m},l="wrapper";function c(e){var a=e.components,o=(0,s.Z)(e,t);return(0,n.kt)(l,(0,r.Z)({},d,o,{components:a,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"transfer\xeancia-de-arquivos"},"Transfer\xeancia de Arquivos"),(0,n.kt)("hr",null),(0,n.kt)("h2",{id:"1-introdu\xe7\xe3o"},"1. Introdu\xe7\xe3o"),(0,n.kt)("p",null,"Para automatizar a transfer\xeancia de arquivos atrav\xe9s de uma rede, por exemplo, 4G, faremos uso de uma rede SSH, caso n\xe3o saiba como criar e configurar uma, temos a explica\xe7\xe3o aqui ",(0,n.kt)("em",{parentName:"p"},"LINK")," , al\xe9m disso, faremos uso da biblioteca python Time, e OS(",(0,n.kt)("em",{parentName:"p"},"LINK"),")"),(0,n.kt)("h2",{id:"2-como-foi-feito"},"2. Como foi feito?"),(0,n.kt)("p",null,"Primeiro, precisa-se adquirir 4 strings, sendo elas, o ip do computador onde ser\xe3o buscados os arquivos(no caso do exemplo, fotos). A primeira seria o ip, que deve possuir o formato \u201cUSUARIO@IPGLOBAL\u201d para redes diferentes, ou \u201cUSUARIO@IPV4\u201d para mesma rede. O segundo deve ser a senha desse usu\xe1rio, e o terceiro e quarto s\xe3o pastas, dados em links de arquivos, sem a \xfaltima barra \u201c~/exemplohome/exemplopasta\u201d."),(0,n.kt)("p",null,"Assim, utilizando o comando system, da biblioteca os, podemos com o python enviar comandos para o terminal bash. Ent\xe3o, antes de tudo \xe9 necess\xe1rio instalar o sshpass, da seguinte forma:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt install sshpass\n")),(0,n.kt)("p",null,"Ap\xf3s isso, j\xe1 podemos continuar nosso c\xf3digo. O primeiro comando que utilizamos \xe9 o b\xe1sico \u201cls\u201d, para retornar os arquivos que tem na pasta do drone, por\xe9m, utilizamos ele de uma forma em que retornamos apenas o primeiro arquivo colocado naquela pasta, dessa forma:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"ls -t <pasta> | tail -1\n")),(0,n.kt)("p",null,"E para conseguirmos mandar ele para a pasta do drone, por ssh, fazemos a conex\xe3o ao ssh, por\xe9m, ao final do comando abrimos e fechamos aspas \xfanicas com o comando dentro, assim ele n\xe3o ir\xe1 conectar ao bash por ssh, e sim apenas enviar aquele comando. Isso \xe9 feito da seguinte forma:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"ssh <usuario>@<ip> \u2018<comando>\u2019\n")),(0,n.kt)("p",null,"No caso, como queremos que isso seja 100% automatizado, faremos uso da biblioteca sshpass, e assim ela ir\xe1 automaticamente autenticar a todo comando, apenas com a string de senha recebida anteriormente, a sintaxe \xe9 assim:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"sshpass -p <senha> ssh <usuario>@<ip> \u2018<comando>\u2019\n")),(0,n.kt)("p",null,"Ent\xe3o, combinando os dois comandos, para buscarmos o primeiro arquivo colocado em uma certa pasta do computador de bordo do drone, fica:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"sshpass -p <senha> ssh <usuario>@<ip> \u2018ls -t <pasta> | tail -1\u2019\n")),(0,n.kt)("p",null,"Obs: \xc9 importante sempre remover o \xfaltimo caracter recebido, pois ele \xe9 um endline"),(0,n.kt)("p",null,"Assim, colocamos o retorno desse comando em uma string, que d\xe1 o nome do arquivo que iremos pegar, o que deve ser concatenada ao endere\xe7o da pasta, desse jeito, podemos copi\xe1-lo para a ground station, e para isso usamos o comando \u201cscp\u201d que copia atrav\xe9s do ssh, e juntamente utilizamos o sshpass para autentica\xe7\xe3o autom\xe1tica, e tudo isso fica dessa forma:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"sshpass -p <senha> scp -r <usuario><ip>:<arquivo>\n")),(0,n.kt)("p",null,"E ap\xf3s termos puxado o arquivo, podemos apag\xe1-lo de quem enviou, e assim, utilizando a mesma ideia no comando ls, faremos a mesma coisa com o comando \u201crm\u201d por ssh, juntamente autenticado pelo sshpass, que fica da seguinte forma:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"sshpass -p <senha> ssh <usuario>@<ip>:<arquivo> \u2018rm <arquivo>\u2019\n")),(0,n.kt)("p",null,"Com isso, j\xe1 estamos pegando os arquivos atrav\xe9s da internet, mas, podemos automatizar mais ainda, e para isso, deixamos dentro de um \u201cwhile True:\u201d, assim, ele vai enviar todos os arquivos daquela pasta, e ainda esperar os pr\xf3ximos que forem colocados e envi\xe1-los tamb\xe9m, al\xe9m disso, para evitar que arquivos sejam sobrescritos por conta de terem o mesmo nome podemos fazer um contador para cada arquivo enviado, sendo assim, cada um tendo um n\xfamero, e renomeamos o arquivo ap\xf3s ser enviado com o comando \u201cmv\u201d, desse jeito:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-python"},"mv <path>/<arquivorecebido> <path>/<nomenovo>+<contador>\n")),(0,n.kt)("h2",{id:"3-c\xf3digo-completo"},"3. C\xf3digo completo"),(0,n.kt)("p",null,"Ele, e outros c\xf3digos, podem ser acessados em nosso github"),(0,n.kt)("p",null,"Mas o c\xf3digo utilizado para tal, est\xe1 tamb\xe9m aqui:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-python"},'  print("Qual o endere\xe7o de ip do drone? (USUARIO@IP")\n  ip = str(input())\n  print("Qual a senha do drone?")\n  senha = str(input())\n  print("Qual a pasta das fotos no drone?")\n  pastaDrone = str(input())\n  print("Qual a pasta das fotos no seu computador?")\n  pastaGs = str(input())\n\n  numeroFoto = 0\n  while True:\n\n    ultimoArqv = os.popen("sshpass -p " + senha + " ssh " + ip + " \'" + "ls -t " + pastaDrone + " | tail -1" + "\'").read() #Pegar o \xfaltimo arquivo colocado\n\n    print("Copiando o " + ultimoArqv)\n\n    os.system("sshpass -p " + senha + " scp -r " + ip + ":" + pastaDrone + "/" + ultimoArqv[:-1] + " " + pastaGs) #Copiar esse arquivo\n    \n    os.system("sshpass -p " + senha + " ssh " + ip +" \'rm " + pastaDrone + "/" + ultimoArqv[:-1] + "\'")\n\n    numeroFoto = numeroFoto + 1\n\n    os.system("mv " + pastaGs + "/" + ultimoArqv[:-1] + " " + pastaGs + "/" + "FOTO" + str(numeroFoto) + ".png")\n')))}c.isMDXComponent=!0}}]);